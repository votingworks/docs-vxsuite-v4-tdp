# Logging

All VxSuite applications use the same framework to log user actions, application processes, and errors. The logs are persisted to disk and can be exported by election managers or system administrators.&#x20;

## Application Log Events

VxSuite applications use a [shared logging library ](https://github.com/votingworks/vxsuite/tree/v4.0.0-release-branch/libs/logging)to capture required or otherwise important application log events. The core metadata for each application log event maps roughly to VVSG 2.0 standards, with some additional fields:

* **Log Event ID** - Internal identifier for each event. The full list of log event IDs with descriptions is included in the automatically generated log [documentation](https://github.com/votingworks/docs-vxsuite-v4/blob/main/software-docs/VotingWorksLoggingDocumentation.md).
* **Log Event Type** - Describes whether the event is a status update or an action, and whether it originated with the user, application, or larger system. The full list of log event types with descriptions is included in the automatically generated log [documentation](https://github.com/votingworks/docs-vxsuite-v4/blob/main/software-docs/VotingWorksLoggingDocumentation.md).
* **User** - If there was an authenticated user role at the time of a user action, describes the role as `system_administrator`, `election_manager`, `poll_worker` or `vendor`. If no user was authenticated, then `unknown`. If event does not originate from the user but rather automatically from the application or operating system, it will be `system`.&#x20;
* **Disposition** - For actions that can fail or succeed, `success` or `failure`. Otherwise `na` for not applicable.
* **Source** - Indicates where in the system's architecture the log came from, whether it be the frontend renderer, the frontend server, the backend server, a hardware daemon, or the operating system.
* **Message** - The log message itself, which may not be present if the log event ID sufficiently describes the event.
* **Other Metadata** - Other metadata can be freely included. For example, if a user adds manual tallies on VxAdmin, the metadata of those manual tallies will be included in the logging.
* **Time Written** - Timestamp of when the log was created.

## Log Management

The shared logging library formats the log events as JSON and pushes them to application processes' `stdout`. All `stdout` output from the application processes - both the application log events and any process output - is sent to the system's `logger` utility and assigned the tag `votingworksapp`.&#x20;

VxSuite uses `rsyslog`, an advanced implementation of the Syslog protocol, to centralize and manage logs from `votingworksapp` and other sources. `rsyslog` has advantages over the built-in Linux `syslog` implementation of the Syslog protocol, including JSON structured messages, advanced filtering, and increased performance. Using `rsyslog`, different types of logs are directed to different log files in `/var/log/votingworks/`:

<table><thead><tr><th width="172">Log File</th><th>Contents</th></tr></thead><tbody><tr><td><code>vx-logs.log</code></td><td><p></p><p>Key logs required by VVSG 2.0 or otherwise critical for understanding the behavior of the application or device, including:</p><ul><li>all application log events</li><li>USB device connection events</li><li>machine boot and shutdown events</li><li>all <code>sudo</code> actions</li><li>password events</li><li><code>dm-verity</code> events</li></ul></td></tr><tr><td><code>auth.log</code></td><td>All operating system authentication-related events. Note that this will not include voting system authentication events such as logging in with a smart card - these events are in <code>vx-logs.log</code></td></tr><tr><td><code>syslog</code></td><td>All other events emitted from the application or the operating system that do not fall into the other log files.</td></tr></tbody></table>

`vx-logs.log`  is the most important and informative file in most cases. The other files rarely need to be referenced. All logs required by VVSG certification will exist in `vx-logs.log.`

Because each log file can grow very large, the application will rotate logs if necessary with the `logrotate` utility on each startup. Previous log files will be compressed and suffixed with a timestamp.&#x20;

Including the various log files and log rotation, below is an example of the list of log files that might appear on a device:

<pre><code><strong>/var/log/votingworks/vx-logs.log
</strong><strong>/var/log/votingworks/vx-logs.log-20241104.gz
</strong>/var/log/votingworks/vx-logs.log-20241105.gz
/var/log/votingworks/auth.log
/var/log/votingworks/syslog
/var/log/votingworks/syslog-20241105.gz
</code></pre>

## Default VotingWorks Log Format

```json
{
    "timeLogWritten":"2024-11-05T15:51:51.246232-08:00",
    "host":"VotingWorks",
    "source":"vx-scan-backend",
    "eventId":"auth-login",
    "eventType":"user-action",
    "user":"poll_worker",
    "message":"User logged in.",
    "disposition":"success",
}
```

The default VotingWorks log format is how logs are formatted when emitted from the application and how they appear in `vx-logs.log`. It is a direct mapping of the[#application-log-events](logging.md#application-log-events "mention") fields.

## CDF Log Format

Logs can be exported in CDF format, in which case the `vx-logs.log` file is replaced by a `vx-logs.cdf.json` file with the logging attributes mapped as follows:

<table><thead><tr><th width="304">CDF Attribute</th><th></th></tr></thead><tbody><tr><td>ElectionEventLog.GeneratedTime</td><td>ISO formatted timestamp of when logs were exported</td></tr><tr><td>ElectionEventLog.Device</td><td>List containing only the current device</td></tr><tr><td>Device.Type</td><td><p>The CDF <code>DeviceType</code> matching the type of machine:</p><ul><li>VxAdmin -> "ems"</li><li>VxScan -> "scan-single"</li><li>VxCentralScan -> "scan-batch"</li><li>VxMark -> "bmd"</li></ul></td></tr><tr><td>Device.Id</td><td>The serial number of the device</td></tr><tr><td>Device.Version</td><td>The software version e.g. "v3.1.2"</td></tr><tr><td>Device.Event</td><td>List of all events</td></tr><tr><td>Event.Id</td><td>A VotingWorks defined identifier for the type of event, such as "save-election-package-complete"</td></tr><tr><td>Event.Disposition</td><td>"success", "failure", "na", or "other"</td></tr><tr><td>Event.OtherDisposition</td><td>If the disposition is "other", the details appear here</td></tr><tr><td>Event.Sequence</td><td>The index of the log in the list of logs, zero-indexed</td></tr><tr><td>Event.TimeStamp</td><td>ISO formatted timestamp of when the event was logged</td></tr><tr><td>Event.Type</td><td>Log event type</td></tr><tr><td>Event.Description</td><td>Log message</td></tr><tr><td>Event.Details</td><td>JSON including the log source and any additional logging metadata</td></tr><tr><td>Event.UserId</td><td>The user at the time of the log</td></tr></tbody></table>

## Error Logs

The log export flow exposed in all VxSuite applications also allows for exporting an errors-only version of the logs. This will only export a log file for logs where the disposition is "failure" and covers all software and hardware errors that have occurred on the machine.&#x20;



## 15.1-D Logging Event Types Table

A full list of all logs made in the system with a description of each one can be found [here](https://github.com/votingworks/docs-vxsuite-v4/blob/main/software-docs/VotingWorksLoggingDocumentation.md). For convenience a table is provided below mapping Table 15-1 from VVSG 2.0 Requirement 15.1-D to the appropriate logs in the VotingWorks system. The details and descriptions provided in Table 15-1 have been simplified for brevity in this table. Some items have been expanded into multiple rows to more precisely specify linked logs.

#### General System Functions

| System Event                                                           | Detail                                                                          | Logging Details                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ---------------------------------------------------------------------- | ------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Device generated error and exception messages                          |                                                                                 | <p>Errors can be logged with any LogEventId but are indicated by a Disposition of <code>failure</code>. All logs contain a Source. Every error is logged when it occurs and each log can be assumed to correspond to one instance of that error occurring unless otherwise stated in the log. <br>VxScan violations of physical security include scanner cover open logs: <code>scanner-state-machine-event</code></p><p><code>scanner-state-machine-transition</code><br>VxScan violations of physical security include scanner cover open logs: <br><code>mark-scan-state-machine-event</code></p><p><code>paper-handler-state-machine-transition</code></p> |
| <p></p><p>Critical system status messages </p>                         | diagnostic and status messages upon startup                                     | `machine-boot-init machine-boot-complete`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Critical system status messages                                        | "zero totals" check                                                             | `polls-opened` `toggled-test-mode`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Critical system status messages                                        | the initiation or termination of scanner and communications equipment operation | <p><code>scanner-state-machine-event</code></p><p><code>scanner-state-machine-transition</code></p><p><code>mark-scan-state-machine-event</code></p><p><code>paper-handler-state-machine-transition</code></p>                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Critical system status messages                                        | Printer errors                                                                  | <p><code>printer-status-changed</code></p><p><code>printer-print-complete</code></p><p><code>paper-handler-state-machine-transition</code><br><br>With disposition of <code>failure</code></p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Critical system status messages                                        | Detection or remediation of malware or other malicious software                 | <p>The system will not boot if malicious software is detected.<br><code>dmverity-boot</code></p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Critical system status messages                                        | Cryptographic boot validation success/failure                                   | `dmverity-boot`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Non-critical status messages                                           |                                                                                 | <p><code>device-attached</code> <br><code>usb-device-change-detected</code><br><code>scanner-state-machine-event</code></p><p><code>scanner-state-machine-transition</code></p><p><code>mark-scan-state-machine-event</code></p><p><code>paper-handler-state-machine-transition</code><br>Various other logs</p>                                                                                                                                                                                                                                                                                                                                               |
| Events that require election official intervention                     |                                                                                 | <p><code>device-unattached</code><br><code>scanner-state-machine-event</code></p><p><code>scanner-state-machine-transition</code></p><p><code>mark-scan-state-machine-event</code></p><p><code>paper-handler-state-machine-transition</code><br><code>auth-login</code> <br><br>Various other logs</p>                                                                                                                                                                                                                                                                                                                                                         |
| Device shutdown and restarts                                           |                                                                                 | `machine-shutdown-init machine-shutdown-complete`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Changes to system configuration settings                               |                                                                                 | It is not possible to change these configuration settings any attempt to do so will result in a `sudo-action` log.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Integrity checks for executables, configuration files, data, and logs  |                                                                                 | `election-configured` and `import-cast-vote-record-complete` logs will have failures if there were errors authenticating the files.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| The addition and deletion of files                                     |                                                                                 | <p><code>file-saved</code><br><code>database-create-complete</code> <br><code>database-destroy-complete</code> <br><code>scanner-state-machine-event</code></p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| System readiness results                                               |                                                                                 | <p><code>diagnostic-init</code><br><code>diagnostic-complete</code><br><code>diagnostic-error</code><br><code>election-configured</code><br><code>polls-opened</code><br><code>toggled-test-mode</code></p>                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Removable media events                                                 |                                                                                 | `usb-device-change-detected`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Backup and restore                                                     |                                                                                 | <p><code>import-cast-vote-records-complete</code><br><code>export-cast-vote-records-complete</code> <br><code>file-saved</code> </p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

#### Authentication and Access Control

| System Event                                           | Detail                 | Logging Details                                                                                                                                                                                                                                                                                                                                                                   |
| ------------------------------------------------------ | ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Authentication related events                          | Login/logoff events    | <p><code>sudo-action</code>  <br><code>auth-login</code><br><code>auth-logout</code><br><code>auth-pin-entry</code></p>                                                                                                                                                                                                                                                           |
|                                                        | Account lockout events | <p><code>auth-pin-entry-lockout</code><br><code>auth-logout</code></p>                                                                                                                                                                                                                                                                                                            |
|                                                        | Password changes       | <p><code>password-change</code><br><code>smart-card-program-complete</code></p>                                                                                                                                                                                                                                                                                                   |
| Access control related events                          |                        | <p><code>sudo-action</code><br><code>password-change</code> </p>                                                                                                                                                                                                                                                                                                                  |
| User account and role (or groups) management activity  |                        | Programming smart cards to create new user accounts: `smart-card-program-complete`. All other security changes can only be made through configuring a new election-package with those settings: `election-configured`. Attempts to bypass or make changes to roles or permissions outside of this will not be allowed and result in a `sudo-action` and/or `password-change` log. |

#### Networking

| System Event                                    | Logging Details                                                                                                                                                      |
| ----------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Enabling or disabling networking functionality  | It is not possible to enable wired or wireless networking. Any attempt to bypass protections in place blocking this will result in an error and a `sudo-action` log. |

#### Software

| System Event                                                               | Logging Details                                                                     |
| -------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| Installing, upgrading, patching, or modifying software or firmware         | `dmverity-boot`                                                                     |
| Changes to configuration settings                                          | `sudo-action` `password-change`                                                     |
| Abnormal process exits                                                     | `unknown-error`                                                                     |
| Successful and failed database connection attempts (if a database is uses) | <p><code>database-connect-init</code><br><code>database-connect-complete</code></p> |
| Changes to cryptographic keys                                              | `sudo-action`                                                                       |

#### Voting Functions

<table><thead><tr><th width="148">System Event </th><th width="415">Detail</th><th>Logging Details</th></tr></thead><tbody><tr><td>Ballot definition and modification </td><td></td><td><code>election-configured election-unconfigured</code></td></tr><tr><td>Voting events </td><td>Opening and closing polls</td><td><code>polls-opened</code><br><code>polls-closed</code> <br><code>voting-paused</code> <br><code>voting-resumed</code> <br><code>reset-polls-to-paused</code></td></tr><tr><td>Voting events </td><td>Casting a vote</td><td>VxMark: <code>vote-cast</code><br><br>VxScan: <code>scanner-state-machine-</code>event with the event <code>scanStart</code> to indicate the voter has started feeding a ballot. If the voter has to cast from adjudication there will be an <code>accept</code> event.</td></tr><tr><td>Voting events </td><td>Canceling a vote during verification</td><td>VxMark: <code>ballot-invalidated</code><br><br>VxScan: <code>scanner-state-machine-event</code> with event <code>reject</code></td></tr><tr><td>Voting events </td><td>Success or failure of log and election results exportation</td><td><code>export-cast-vote-record-complete</code><br><code>file-saved</code> </td></tr></tbody></table>

