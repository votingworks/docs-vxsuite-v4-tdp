# Cryptography

## Cryptographic Modules

VxSuite v4 contains four distinct cryptographic modules:

* Smart cards
* VxAdmin / VxCentralScan TPM (same underlying hardware)
* VxMark TPM
* VxScan TPM
* OpenSSL software

All of the above are FIPS-compliant.

### Smart Cards

VxSuite v4 uses NXP JCOP 4 Java Cards, specifically this model: [https://www.cardlogix.com/product/nxp-jcop-4-java-card-3-0-5-classic](https://www.cardlogix.com/product/nxp-jcop-4-java-card-3-0-5-classic).

These smart cards are FIPS140-2-certified:\
[https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/3746](https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/3746).

The applet that we run on the cards, [OpenFIPS201](https://github.com/votingworks/OpenFIPS201), is an implementation of the NIST 201 PIV protocol, which sits on top of FIPS140 cryptography. In the applet, all cryptographic operations are handled by the Java Card operating system, implemented by the NXP JCOP 4 card.

### VxAdmin / VxCentralScan TPM

The VxAdmin / VxCentralScan HP uses an NPCT75x TPM 2.0 chip by Nuovoton.

This chip is FIPS140-2-certified: [https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/4411](https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/4411).

### VxMark TPM

The VxMark board uses an SLB 9665 TPM 2.0 chip by Infineon.

This chip is FIPS140-2-certified: [https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/2959](https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/2959).

### VxScan TPM

The VxScan board uses an SLB 9670 TPM 2.0 chip by Infineon.

This chip is FIPS140-2-certified: [https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/3492](https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/3492).

### OpenSSL

We use OpenSSL 3.0.9 and install the FIPS provider, per [these instructions](https://github.com/openssl/openssl/blob/master/README-FIPS.md#installing-the-fips-provider).

This provider is FIPS140-2-certified: [https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/4282](https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/4282).

FIPS-compliance of all OpenSSL operations is guaranteed as follows:

* **FIPS compliance via hardware modules:** For relevant operations, OpenSSL outsources cryptographic operations to the TPM 2.0 chip, and as noted above, all of our TPM 2.0 chips are FIPS-compliant.
* **FIPS compliance via software modules:** For all other operations, OpenSSL uses the FIPS provider. Our [OpenSSL config](https://github.com/votingworks/vxsuite-build-system/blob/main/playbooks/trusted_build/files/openssl-3.0.9.cnf) guarantees this.

## Authentication vs. Encryption

VxSuite does not use encryption to secure data (election definitions, CVRs) while in transit on USB drives because that data does not need to be confidential – and in fact trust in a voting system is better achieved by transparency of this data. In particular, CVRs stored on USB drives are not encrypted so that they can be viewed using any computer. This is by design.

On the other hand, VxSuite strongly **authenticates** all data, which is critical. Thus, election definitions and CVRs are in plaintext on the USB drives that transfer them, accompanied by strong digital signatures, generated by signing keys stored in hardware TPMs.

VxSuite _does_ encrypt data at rest on machines' internal drives, specifically their `/var` partitions.

## Cryptographic Keying Material

All digital signatures for authenticating election definitions and CVRs are generated using ECC 256-bit keys, that further use the NIST standard P-256 curve.

All hashes – for generating election IDs, digesting data before signing, constructing the Merkle-tree hash for CVRs, and constructing the dm-verity system integrity hash – are generated using the NIST standard SHA-256.

Encryption of disk partitions is done using AES with 256-bit keys in XTS mode.

Secure Boot code signing uses RSA 4096-bit keys.
