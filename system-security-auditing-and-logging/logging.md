# Logging

All VxSuite applications use the same framework to log user actions, application processes, and errors. The logs are persisted to disk and can be exported by election managers or system administrators.&#x20;

## Application Log Events

VxSuite applications use a [shared logging library ](https://github.com/votingworks/vxsuite/tree/v4.0.0-release-branch/libs/logging)to capture required or otherwise important application log events. The core metadata for each application log event maps roughly to VVSG 2.0 standards, with some additional fields:

* **Log Event ID** - The unique identifier for each event. The full list of log event IDs with descriptions is included in the automatically generated log [documentation](https://github.com/votingworks/docs-vxsuite-v4/blob/main/software-docs/VotingWorksLoggingDocumentation.md).
* **Log Event Type** - Describes whether the event is a status update or an action, and whether it originated with the user, application, or larger system. The full list of log event types with descriptions is included in the automatically generated log [documentation](https://github.com/votingworks/docs-vxsuite-v4/blob/main/software-docs/VotingWorksLoggingDocumentation.md).
* **User** - If there was an authenticated user role at the time of a user action, describes the role as `system_administrator`, `election_manager`, `poll_worker` or `vendor`. If no user was authenticated, then `unknown`. If event does not originate from the user but rather automatically from the application or operating system, it will be `system`.&#x20;
* **Disposition** - For actions that can fail or succeed, `success` or `failure`. Otherwise `na` for not applicable.
* **Source** - Indicates where in the system's architecture the log came from, whether it be the frontend renderer, the frontend server, the backend server, a hardware daemon, or the operating system.
* **Message** - The log message itself, which may not be present if the log event ID sufficiently describes the event.
* **Other Metadata** - Other metadata can be freely included. For example, if a user adds manual tallies on VxAdmin, the metadata of those manual tallies will be included in the logging.
* **Time Written** - Timestamp of when the log was created.

## Log Management

The shared logging library formats the log events as JSON and pushes them to application processes' `stdout`. All `stdout` output from the application processes - both the application log events and any process output - is sent to the system's `logger` utility and assigned the tag `votingworksapp`.&#x20;

VxSuite uses `rsyslog`, an advanced implementation of the Syslog protocol, to centralize and manage logs from `votingworksapp` and other sources. `rsyslog` has advantages over the built-in Linux `syslog` implementation of the Syslog protocol, including JSON structured messages, advanced filtering, and increased performance. Using `rsyslog`, different types of logs are directed to different log files in `/var/log/votingworks/`:

<table><thead><tr><th width="172">Log File</th><th>Contents</th></tr></thead><tbody><tr><td><code>vx-logs.log</code></td><td><p></p><p>Key logs required by VVSG 2.0 or otherwise critical for understanding the behavior of the application or device, including:</p><ul><li>all application log events</li><li>USB device connection events</li><li>machine boot and shutdown events</li><li>all <code>sudo</code> actions</li><li>password events</li><li><code>dm-verity</code> events</li></ul></td></tr><tr><td><code>auth.log</code></td><td>All operating system authentication-related events. Note that this will not include voting system authentication events such as logging in with a smart card - these events are in <code>vx-logs.log</code></td></tr><tr><td><code>syslog</code></td><td>All other events emitted from the application or the operating system that do not fall into the other log files.</td></tr></tbody></table>

`vx-logs.log`  is the most important and informative file in most cases. The other files rarely need to be referenced. All logs required by VVSG certification will exist in `vx-logs.log.`

Because each log file can grow very large, the application will rotate logs if necessary with the `logrotate` utility on each startup. Previous log files will be compressed and suffixed with a timestamp.&#x20;

Including the various log files and log rotation, below is an example of the list of log files that might appear on a device:

<pre><code><strong>/var/log/votingworks/vx-logs.log
</strong><strong>/var/log/votingworks/vx-logs.log-20241104.gz
</strong>/var/log/votingworks/vx-logs.log-20241105.gz
/var/log/votingworks/auth.log
/var/log/votingworks/syslog
/var/log/votingworks/syslog-20241105.gz
</code></pre>

## Default VotingWorks Log Format

```json
{
    "timeLogWritten":"2024-11-05T15:51:51.246232-08:00",
    "host":"VotingWorks",
    "source":"vx-scan-backend",
    "eventId":"auth-login",
    "eventType":"user-action",
    "user":"poll_worker",
    "message":"User logged in.",
    "disposition":"success",
}
```

The default VotingWorks log format is how logs are formatted when emitted from the application and how they appear in `vx-logs.log`. It is a direct mapping of the[#application-log-events](logging.md#application-log-events "mention") fields.

## CDF Log Format

Logs can be exported in CDF format, in which case the `vx-logs.log` file is replaced by a `vx-logs.cdf.json` file with the logging attributes mapped as follows:

<table><thead><tr><th width="304">CDF Attribute</th><th></th></tr></thead><tbody><tr><td>ElectionEventLog.GeneratedTime</td><td>ISO formatted timestamp of when logs were exported</td></tr><tr><td>ElectionEventLog.Device</td><td>List containing only the current device</td></tr><tr><td>Device.Type</td><td><p>The CDF <code>DeviceType</code> matching the type of machine:</p><ul><li>VxAdmin -> "ems"</li><li>VxScan -> "scan-single"</li><li>VxCentralScan -> "scan-batch"</li><li>VxMark -> "bmd"</li></ul></td></tr><tr><td>Device.Id</td><td>The serial number of the device</td></tr><tr><td>Device.Version</td><td>The software version e.g. "v3.1.2"</td></tr><tr><td>Device.Event</td><td>List of all events</td></tr><tr><td>Event.Id</td><td>A VotingWorks defined identifier for the type of event, such as "save-election-package-complete"</td></tr><tr><td>Event.Disposition</td><td>"success", "failure", "na", or "other"</td></tr><tr><td>Event.OtherDisposition</td><td>If the disposition is "other", the details appear here</td></tr><tr><td>Event.Sequence</td><td>The index of the log in the list of logs, zero-indexed</td></tr><tr><td>Event.TimeStamp</td><td>ISO formatted timestamp of when the event was logged</td></tr><tr><td>Event.Type</td><td>Log event type</td></tr><tr><td>Event.Description</td><td>Log message</td></tr><tr><td>Event.Details</td><td>JSON including the log source and any additional logging metadata</td></tr><tr><td>Event.UserId</td><td>The user at the time of the log</td></tr></tbody></table>

## Error Logs

The log export flow exposed in all VxSuite applications also allows for exporting an errors-only version of the logs. This will only export a log file for logs where the disposition is "failure" and covers all software and hardware errors that have occurred on the machine.

## 15.1-D Logging Event Types Table

A full list of all logs made in the system with a description of each one can be found [here](https://github.com/votingworks/docs-vxsuite-v4/blob/main/software-docs/VotingWorksLoggingDocumentation.md). For convenience a table is provided below mapping Table 15-1 from VVSG 2.0 Requirement 15.1-D to the appropriate logs in the VotingWorks system. The details and descriptions provided in Table 15-1 have been simplified for brevity in this table. Some items have been expanded into multiple rows to more precisely specify linked logs.

#### General System Functions

<table><thead><tr><th width="233">System Event</th><th>Detail</th><th>Logging Details</th></tr></thead><tbody><tr><td>Device generated error and exception messages</td><td>Entries into exception handling routines</td><td>Errors can be logged with any LogEventId but are indicated by a <code>failure</code> Disposition. All logs contain a Source. Every error is logged when it occurs, and each log can be assumed to correspond to one instance of that error occurring unless otherwise stated in the log.<br><br>Of particular note are logs with LogEventId <code>unknown-error</code>. These represent unexpected system errors, as opposed to user errors.</td></tr><tr><td>Device generated error and exception messages</td><td>Notifications of physical violations of security</td><td><p>VxMark physical violations of security are covered by printer-scanner cover-open logs. These will have a LogEventId of <code>paper-handler-state-machine-transition</code> with a body <code>Transitioned to: "cover_opened_unauthorized"</code></p><p><br>The VxScan scanner cover is intended to be opened by poll workers for maintenance, so this does not constitute a physical violation of security. Nonetheless, logs are also emitted for this case. These will have a LogEventId of <code>scanner-state-machine-transition</code> with body <code>Transitioned to: "cover_open"</code></p></td></tr><tr><td>Device generated error and exception messages</td><td>Other exception events such as power failures, failure of critical hardware components, data transmission errors, or other types of operating anomalies</td><td><p>On VxMark, hardware failures are covered by logs with LogEventId <code>paper-handler-state-machine-transition</code> and body <code>Transitioned to: "no_hardware"</code></p><p><br>On VxScan, hardware failures are covered by logs with LogEventId <code>scanner-state-machine-transition</code> and body <code>Transitioned to: "disconnected"</code></p></td></tr><tr><td>Device generated error and exception messages</td><td>Recovery actions taken</td><td>Recovery actions will vary for every error and can therefore map to any log. Recommended recovery actions for user-facing errors are documented in our user manual under the following pages:<br><a data-mention href="https://app.gitbook.com/s/JtZutzGTdCzsGITrdiph/vxadmin-error-messages">VxAdmin Error Messages</a><br><a data-mention href="https://app.gitbook.com/s/JtZutzGTdCzsGITrdiph/vxcentralscan-error-messages">VxCentralScan Error Messages</a><br><a data-mention href="https://app.gitbook.com/s/JtZutzGTdCzsGITrdiph/vxmark/vxmark-error-messages">VxMark Error Messages</a><br><a data-mention href="https://app.gitbook.com/s/JtZutzGTdCzsGITrdiph/vxscan/vxscan-error-messages">VxScan Error Messages</a></td></tr><tr><td>Critical system status messages</td><td>Diagnostic and status messages upon startup</td><td><code>machine-boot-init</code><br><code>machine-boot-complete</code></td></tr><tr><td>Critical system status messages </td><td>The "zero totals" check</td><td><code>polls-opened</code><br><code>toggled-test-mode</code></td></tr><tr><td>Critical system status messages </td><td>The initiation or termination of scanner and communications equipment operation</td><td><p><code>scanner-state-machine-event</code></p><p><code>scanner-state-machine-transition</code></p><p><code>mark-scan-state-machine-event</code></p><p><code>paper-handler-state-machine-transition</code></p></td></tr><tr><td>Critical system status messages </td><td>Printer errors</td><td><code>printer-status-changed</code><br><code>printer-print-complete</code><br><code>paper-handler-state-machine-transition</code><br><br>With a <code>failure</code> Disposition</td></tr><tr><td>Critical system status messages </td><td>Detection or remediation of malware or other malicious software</td><td>Malware or other malicious software is prevented from being added to VotingWorks systems via our <a href="system-security-architecture/system-integrity.md">System Integrity</a> design. Rather than using a traditional "allowlist" that is only applicable to malware, we create a system-wide hash of the expected system content. If anything changes, whether via malware or some other method, the system will no longer boot and will present a <code>dm-verity</code> failure message. <br><br><code>dm-verity</code> with a <code>failure</code> Disposition</td></tr><tr><td>Critical system status messages </td><td>Cryptographic boot validation success/failure</td><td><code>dmverity-boot</code> with success or failure indicated by the Disposition</td></tr><tr><td>Non-critical status messages </td><td></td><td><p><code>device-attached</code><br><code>usb-device-change-detected</code><br><code>scanner-state-machine-event</code></p><p><code>scanner-state-machine-transition</code></p><p><code>mark-scan-state-machine-event</code></p><p><code>paper-handler-state-machine-transition</code><br><br>Various other logs</p></td></tr><tr><td>Events that require election official intervention </td><td></td><td><p><code>device-unattached</code><br><code>scanner-state-machine-event</code></p><p><code>scanner-state-machine-transition</code></p><p><code>mark-scan-state-machine-event</code></p><p><code>paper-handler-state-machine-transition</code><br><code>auth-login</code> <br><br>Various other logs</p></td></tr><tr><td>Device shutdown and restarts </td><td></td><td><code>machine-shutdown-init</code> indicates the start of a shutdown or restart.<br><br>If followed by a <code>machine-shutdown-complete</code> log, the shutdown or restart can be taken to be successful.<br><br>Otherwise, it can be considered abnormal. In the case of a restart, we additionally expect a <code>machine-boot-init</code> and <code>machine-boot-complete</code> log.</td></tr><tr><td>Changes to system configuration settings</td><td></td><td>It is not possible to change these configuration settings, and any attempt to do so will result in a <code>sudo-action</code> log.</td></tr><tr><td>Integrity checks for executables, configuration files, data, and logs </td><td></td><td><p>For election package configuration, a failed integrity check will result in an <code>election-configured</code> log with a <code>failure</code> Disposition and <code>Election package authentication erred</code> in the message.</p><p><br>For CVR import, a failed integrity check will result in an <code>import-cast-vote-records-complete</code> log with a <code>failure</code> Disposition and <code>authentication-error</code> in the error details.</p><p><br>For the file system as a whole, a failed integrity check will result in a <code>dm-verity</code> log with a <code>failure</code> Disposition.</p><p><br>All of the above logs, if seen with a <code>success</code> Disposition, indicate successful integrity checks.</p></td></tr><tr><td>The addition and deletion of files </td><td></td><td><p>The overwhelming majority of machine data is stored in a database, the creation and destruction of which are captured in <code>database-create-complete</code> and <code>database-destroy-complete</code> logs.</p><p><br>The only other files stored on the file system are scan images on VxCentralScan and VxScan. On VxCentralScan, scan image file creations pair with <code>scan-sheet-complete</code> logs, and scan image file deletions (without a complete unconfiguration) pair with <code>clear-ballot-data-complete</code> and <code>delete-cvr-batch-complete</code>. On VxScan, scan image file creations pair with <code>scanner-state-machine-transition</code> logs, where the body includes <code>Transitioned to: "interpreting"</code>, and scan image file deletions (without a complete unconfiguration) pair with <code>toggled-test-mode-complete</code> logs.</p><p><br>On all machines, user-triggered exports of reports and logs to USB drives pair with <code>file-saved</code> logs. We don't expose functionality to delete these files individually. They can be cleared by formatting the USB drive, however, for which a <code>usb-drive-format-complete</code> log will be emitted.</p></td></tr><tr><td>System readiness results</td><td>System pass or fail of hardware and software test for system readiness</td><td><code>diagnostic-init</code><br><code>diagnostic-complete</code><br><code>diagnostic-error</code><br><code>election-configured</code><br><code>polls-opened</code><br><code>toggled-test-mode</code></td></tr><tr><td>System readiness results</td><td>Identification of the software release, identification of the election to be processed, polling place identification, and the results of the software and hardware diagnostic tests</td><td>The software release can be verified using <a data-mention href="../system-overview/signed-hash-validation.md">signed-hash-validation.md</a>, for which a <code>signed-hash-validation-complete</code> log will be emitted.<br><br>The election, specifically ballot hash, can be found in the <code>election-configured</code> log.<br><br>The polling place can be found in the  <code>polls-opened</code> log as well as the <code>precinct-configuration-changed</code> log if a change was made from the default selection.<br><br>The results of software and hardware diagnostic tests can be found in <code>diagnostic-complete</code> and <code>diagnostic-error</code> logs.</td></tr><tr><td>System readiness results</td><td>Pass or fail of ballot style compatibility and integrity tes</td><td>The <code>election-configured</code> log with a <code>success</code> Disposition indicates a pass. That log with a <code>failure</code> Disposition indicates a fail. More on integrity checks a few rows up in this table.</td></tr><tr><td>System readiness results</td><td>Pass or fail of system test data removal</td><td>The <code>toggled-test-mode</code> log with a <code>success</code> Disposition indicates a pass. The <code>toggled-test-mode</code> log with a <code>failure</code> disposition indicates a fail.</td></tr><tr><td>System readiness results</td><td>Zero totals of data paths and memory locations for vote recording</td><td>The <code>polls-opened</code> log with a <code>success</code> Disposition indicates a pass. The <code>polls-opened</code> log with a <code>failure</code> Disposition and <code>User prevented from opening polls because ballots have already been scanned</code> in the body indicates a fail.</td></tr><tr><td>Removable media events </td><td></td><td><code>usb-device-change-detected</code></td></tr><tr><td>Backup and restore </td><td></td><td><p>On VxCentralScan and VxScan, full CVR exports serve as backups. These pair with <code>cast-vote-records-complete</code> logs. This data is not, however, intended to be loaded back onto VxCentralScan and VxScan, so there is not an equivalent restore operation. Because VxMark does not tabulate, there are no CVRs on it to backup.</p><p></p><p>On all machines, user-triggered exports of reports and logs to USB drives pair with <code>file-saved</code> logs. This data is also not meant to be loaded back into the system.</p></td></tr></tbody></table>

#### Authentication and Access Control

| System Event                                           | Detail                 | Logging Details                                                                                                                                                                                                                                                                                                                                                                   |
| ------------------------------------------------------ | ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Authentication related events                          | Login/logoff events    | <p><code>sudo-action</code>  <br><code>auth-login</code><br><code>auth-logout</code><br><code>auth-pin-entry</code></p>                                                                                                                                                                                                                                                           |
|                                                        | Account lockout events | <p><code>auth-pin-entry-lockout</code><br><code>auth-logout</code></p>                                                                                                                                                                                                                                                                                                            |
|                                                        | Password changes       | <p><code>password-change</code><br><code>smart-card-program-complete</code></p>                                                                                                                                                                                                                                                                                                   |
| Access control related events                          |                        | <p><code>sudo-action</code><br><code>password-change</code> </p>                                                                                                                                                                                                                                                                                                                  |
| User account and role (or groups) management activity  |                        | Programming smart cards to create new user accounts: `smart-card-program-complete`. All other security changes can only be made through configuring a new election-package with those settings: `election-configured`. Attempts to bypass or make changes to roles or permissions outside of this will not be allowed and result in a `sudo-action` and/or `password-change` log. |

#### Networking

| System Event                                    | Logging Details                                                                                                                                                      |
| ----------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Enabling or disabling networking functionality  | It is not possible to enable wired or wireless networking. Any attempt to bypass protections in place blocking this will result in an error and a `sudo-action` log. |

#### Software

| System Event                                                               | Detail                                                                                                                                                                                                      | Logging Details                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| -------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Installing, upgrading, patching, or modifying software or firmware         |                                                                                                                                                                                                             | <p>Because we update software by completely reimaging machines, all logs prior to updating are cleared. We procedurally make sure that logs are exported before beginning a software update.<br><br>A <code>sudo-action</code> log that references an <code>expand-var-filesystem.sh</code> command is indicative of a freshly imaged/updated machine.<br><br>The software version/hash, both before and after update, can be verified using <a data-mention href="../system-overview/signed-hash-validation.md">signed-hash-validation.md</a>, for which a <code>signed-hash-validation-complete</code> log will be emitted.<br><br>The software version/hash is also logged on every boot in a subset of the <code>dmverity-boot</code> logs. Searching for <code>verity.hash</code> in the vx-logs.log file will help you hone in on these logs.</p> |
| Changes to configuration settings                                          | Changes to critical function settings, including location of election definition file, contents of the election definition file, vote reporting, location of logs, and voting device configuration settings | <p>The location of the election definition and logs cannot be changed; both are stored in static locations. Changes to the contents of the election definition pair with <code>election-configured</code> and <code>election-unconfigured</code> logs.<br><br>The are no controls outside of election definition configuration that affect how votes are reported.<br><br>Other voting device configuration settings are covered by <code>continuous-export-toggled</code>, <code>double-sheet-toggled</code>, <code>sound-toggled</code>, and <code>toggled-test-mode</code> logs.</p>                                                                                                                                                                                                                                                                 |
| Changes to configuration settings                                          | Changes to device settings including, but not limited to, enabling and disabling services                                                                                                                   | As noted above, device settings are covered by `continuous-export-toggled`, `double-sheet-toggled`, `sound-toggled`, and `toggled-test-mode` logs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Changes to configuration settings                                          | Starting and stopping processes                                                                                                                                                                             | For lower-level hardware daemons, we have `process-started` and `process-terminated` logs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Abnormal process exits                                                     |                                                                                                                                                                                                             | `unknown-error`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Successful and failed database connection attempts (if a database is used) |                                                                                                                                                                                                             | <p><code>database-connect-init</code><br><code>database-connect-complete</code></p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Changes to cryptographic keys                                              |                                                                                                                                                                                                             | A machine TPM key is created during initial configuration by VotingWorks after software imaging. This operation pairs with a `sudo-action` log that references a `generate-key.sh` command. No additional keys can be added, nor can this key be deleted. The key can however be changed by VotingWorks, via use of a vendor smart card. The change will also show up in the logs as a `sudo-action` that references the `generate-key.sh` command.                                                                                                                                                                                                                                                                                                                                                                                                     |

#### Voting Functions

<table><thead><tr><th width="148">System Event </th><th width="415">Detail</th><th>Logging Details</th></tr></thead><tbody><tr><td>Ballot definition and modification </td><td></td><td><code>election-configured election-unconfigured</code></td></tr><tr><td>Voting events </td><td>Opening and closing polls</td><td><code>polls-opened</code><br><code>polls-closed</code> <br><code>voting-paused</code> <br><code>voting-resumed</code> <br><code>reset-polls-to-paused</code></td></tr><tr><td>Voting events </td><td>Casting a vote</td><td>VxMark: <code>vote-cast</code><br><br>VxScan: <code>scanner-state-machine-</code>event with the event <code>scanStart</code> to indicate the voter has started feeding a ballot. If the voter has to cast from adjudication there will be an <code>accept</code> event.</td></tr><tr><td>Voting events </td><td>Canceling a vote during verification</td><td>VxMark: <code>ballot-invalidated</code><br><br>VxScan: <code>scanner-state-machine-event</code> with event <code>reject</code></td></tr><tr><td>Voting events </td><td>Success or failure of log and election results exportation</td><td><code>export-cast-vote-record-complete</code><br><code>file-saved</code> </td></tr></tbody></table>

